# Story 6.2: Conversation Analytics Page

**Status**: Draft  
**Epic**: User Experience and Navigation Enhancement  
**Assigned Agent**: dev  

## Story

**As a** support manager and administrator,  
**I want** a comprehensive Conversation Analytics page similar to Issue Analytics that provides insights into conversation performance, sentiment analysis, resolution patterns, and agent effectiveness,  
**so that** I can make data-driven decisions to improve customer service quality, optimize agent performance, and identify conversation trends and patterns.

## Acceptance Criteria

1. **Navigation Menu Integration**: Add "Conversation Analytics" menu item to the CONVERSATIONS section in MenuService with appropriate role-based permissions (Admin and Users roles)
2. **Page Structure**: Create analytics page at route `/conversations/analytics` with header, KPI cards, charts, and performance tables similar to Issue Analytics
3. **Date Range Filtering**: Implement date range picker to filter analytics data with default 30-day range and real-time data refresh
4. **KPI Dashboard Cards**: Display key metrics including:
   - Total Conversations
   - Average Resolution Time
   - Average Sentiment Score
   - Escalation Rate
   - Agent Response Time
   - Customer Satisfaction Score
5. **Conversation Volume Charts**: Display conversation volume trends over time with line charts showing daily/weekly patterns
6. **Sentiment Analysis Visualization**: Show sentiment distribution (Positive, Neutral, Negative) with pie charts and sentiment trends over time
7. **Resolution Performance**: Display resolution success rates, time-to-resolution analysis, and escalation patterns
8. **Agent Performance Metrics**: Show agent-specific metrics including conversation count, average resolution time, and sentiment scores
9. **Channel Performance**: Display performance metrics by conversation channel (WhatsApp, Web, etc.)
10. **Real-time Updates**: Integrate SignalR for real-time analytics updates when new conversations are completed or insights are processed
11. **Export Functionality**: Provide export capability for analytics reports (placeholder for future PDF/Excel export)
12. **Responsive Design**: Ensure analytics dashboard works properly on desktop, tablet, and mobile devices using MudBlazor grid system

## Tasks / Subtasks

- [ ] **Task 1: Navigation Menu Integration** (AC: 1)
  - [ ] Add Conversation Analytics menu item to MenuService in CONVERSATIONS section
  - [ ] Set appropriate permissions (Admin and Users roles)
  - [ ] Add localization entries for menu item

- [ ] **Task 2: Create Analytics Page Structure** (AC: 2, 3)
  - [ ] Create `/Pages/Conversations/Analytics.razor` page component
  - [ ] Implement page routing and authorization attributes
  - [ ] Add date range picker with default 30-day range
  - [ ] Create page header with title, icons, and action buttons

- [ ] **Task 3: Implement Analytics Queries** (AC: 4-9)
  - [ ] Create `GetConversationDashboardMetricsQuery` with MediatR handler
  - [ ] Create `GetConversationPerformanceStatsQuery` with MediatR handler
  - [ ] Implement DTOs for conversation analytics data
  - [ ] Add database queries for conversation insights and metrics

- [ ] **Task 4: Create KPI Cards Component** (AC: 4)
  - [ ] Create `ConversationKpiCardsComponent.razor` 
  - [ ] Display total conversations, resolution time, sentiment, escalation rate
  - [ ] Add agent response time and customer satisfaction metrics
  - [ ] Style cards consistently with existing KPI components

- [ ] **Task 5: Implement Volume and Trend Charts** (AC: 5)
  - [ ] Create `ConversationVolumeTrendsChart.razor` component
  - [ ] Implement time-series chart for conversation volume
  - [ ] Add daily/weekly trend analysis
  - [ ] Use ApexCharts for interactive visualization

- [ ] **Task 6: Create Sentiment Analysis Visualizations** (AC: 6)
  - [ ] Create `SentimentDistributionChart.razor` component
  - [ ] Create `SentimentTrendsChart.razor` component
  - [ ] Display sentiment breakdown (Positive, Neutral, Negative)
  - [ ] Show sentiment score trends over time

- [ ] **Task 7: Build Resolution Performance Components** (AC: 7)
  - [ ] Create `ConversationResolutionAnalysis.razor` component
  - [ ] Display resolution success rates and patterns
  - [ ] Show time-to-resolution metrics
  - [ ] Add escalation pattern analysis

- [ ] **Task 8: Create Agent Performance Tables** (AC: 8)
  - [ ] Create `AgentPerformanceTable.razor` component
  - [ ] Display agent-specific conversation metrics
  - [ ] Show resolution times and sentiment scores per agent
  - [ ] Add sorting and filtering capabilities

- [ ] **Task 9: Implement Channel Performance Analysis** (AC: 9)
  - [ ] Create `ConversationChannelPerformanceTable.razor` component
  - [ ] Display metrics by conversation channel
  - [ ] Show performance comparison across channels
  - [ ] Include channel-specific insights

- [ ] **Task 10: Add Real-time Updates** (AC: 10)
  - [ ] Integrate SignalR hub connection for conversation updates
  - [ ] Listen for conversation completion and insight processing events
  - [ ] Refresh analytics data automatically on relevant events
  - [ ] Handle connection errors gracefully

- [ ] **Task 11: Responsive Design Implementation** (AC: 12)
  - [ ] Use MudBlazor grid system for responsive layout
  - [ ] Test analytics dashboard on desktop, tablet, and mobile
  - [ ] Ensure charts and tables adapt to different screen sizes
  - [ ] Optimize component performance for mobile devices

- [ ] **Task 12: Add Export Functionality** (AC: 11)
  - [ ] Add export button placeholder in page header
  - [ ] Implement basic export preparation (data gathering)
  - [ ] Add TODO comments for future PDF/Excel implementation
  - [ ] Ensure export respects current date range filter

## Dev Notes

### Previous Story Insights
- Based on successful Issue Analytics implementation in story 6.1, following similar patterns for consistency
- Conversation system already has rich data model with ConversationInsight entity for sentiment and analysis data
- SignalR integration patterns established in Issue Analytics can be reused

### Data Models
**Conversation Entity** (Existing):
- Conversation.ConversationReference: Bot Framework identifier [Source: src/Domain/Entities/Conversation.cs]
- Conversation.Status: ConversationStatus enum (Active, Escalated, Completed, Abandoned) [Source: src/Domain/Entities/Conversation.cs]
- Conversation.Mode: ConversationMode enum (Bot, Human, Escalating) [Source: src/Domain/Entities/Conversation.cs]
- Conversation.Priority: Integer priority level (1=Standard, 2=High, 3=Critical) [Source: src/Domain/Entities/Conversation.cs]
- Conversation.ResolutionCategory: Resolution categorization enum [Source: src/Domain/Entities/Conversation.cs]
- Conversation.MessageCount: Total messages in conversation [Source: src/Domain/Entities/Conversation.cs]
- Conversation.Duration: Calculated property for conversation length [Source: src/Domain/Entities/Conversation.cs]

**ConversationInsight Entity** (Existing):
- ConversationInsight.SentimentScore: Decimal (-1.0 to 1.0) overall sentiment [Source: src/Domain/Entities/ConversationInsight.cs]
- ConversationInsight.SentimentLabel: Human readable sentiment label [Source: src/Domain/Entities/ConversationInsight.cs]
- ConversationInsight.KeyThemes: JSON array of extracted themes [Source: src/Domain/Entities/ConversationInsight.cs]
- ConversationInsight.ResolutionSuccess: Boolean success indicator [Source: src/Domain/Entities/ConversationInsight.cs]
- ConversationInsight.CustomerSatisfactionIndicators: JSON satisfaction signals [Source: src/Domain/Entities/ConversationInsight.cs]
- ConversationInsight.ProcessingModel: AI model used for analysis [Source: src/Domain/Entities/ConversationInsight.cs]

### API Specifications
**Query Handlers**: Follow CQRS pattern with MediatR [Source: architecture/backend-architecture.md#CQRS Implementation]
- GetConversationDashboardMetricsQuery: Returns KPI metrics for dashboard cards
- GetConversationPerformanceStatsQuery: Returns detailed performance statistics for charts and tables
- Both queries should support date range filtering and tenant isolation

**Response DTOs**: Create corresponding DTOs following existing patterns [Source: architecture/data-models.md]
- ConversationDashboardMetricsDto: KPI data structure
- ConversationPerformanceStatsDto: Chart and table data structure
- Include chart data arrays and performance breakdowns

### Component Specifications
**UI Components**: Follow MudBlazor component patterns [Source: architecture/components.md#Blazor Server UI Layer]
- Page layout using MudPaper with elevation and proper spacing
- MudGrid for responsive layout following Issue Analytics pattern
- ApexCharts integration for interactive visualizations
- Consistent styling with existing analytics components

**Chart Components**: Use ApexCharts.NET for data visualization [Source: architecture/tech-stack.md]
- Line charts for volume trends and sentiment over time
- Pie charts for sentiment and resolution distribution
- Bar charts for agent and channel performance comparison
- Interactive features like zoom, pan, and data point tooltips

### File Locations
**Page Component**: src/Server.UI/Pages/Conversations/Analytics.razor [Source: architecture/unified-project-structure.md]
**Chart Components**: src/Server.UI/Components/Conversations/ directory [Source: architecture/unified-project-structure.md]
**Query Handlers**: src/Application/Features/Conversations/Queries/ [Source: architecture/unified-project-structure.md]
**DTOs**: src/Application/Features/Conversations/DTOs/ [Source: architecture/unified-project-structure.md]

### Testing Requirements
**Component Testing**: Use bUnit for Blazor component testing [Source: architecture/testing-strategy.md]
- Test analytics page rendering with mock data
- Test chart component data binding and display
- Test responsive behavior and layout adaptation

**Integration Testing**: Test query handlers and data access [Source: architecture/testing-strategy.md]
- Test conversation metrics calculation accuracy
- Test date range filtering functionality
- Test multi-tenant data isolation

**E2E Testing**: Use Playwright for end-to-end scenarios [Source: architecture/testing-strategy.md]
- Test full analytics dashboard workflow
- Test real-time updates via SignalR
- Test export functionality preparation

### Technical Constraints
**Performance**: Dashboard must load within 2 seconds with up to 1000 conversations [Source: architecture/tech-stack.md#Performance Requirements]
**Caching**: Use FusionCache for analytics data caching with appropriate TTL [Source: architecture/tech-stack.md]
**Multi-tenant**: All queries must respect tenant isolation [Source: architecture/backend-architecture.md#Multi-tenancy]
**Real-time**: SignalR integration for live updates following established patterns [Source: architecture/components.md#SignalR Integration]

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-08 | 1.0 | Initial story creation for Conversation Analytics | Scrum Master (Bob) |

## Dev Agent Record

*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be populated by dev agent*

### Debug Log References
*To be populated by dev agent*

### Completion Notes List
*To be populated by dev agent*

### File List
*To be populated by dev agent*

## QA Results

*Results from QA Agent review will be populated here*
