# Story 5.2: Conversations Menu Navigation

**Status**: Ready for Review  
**Epic**: Issue Management Enhancement  
**Assigned Agent**: dev  

## Story

**As a** support agent,  
**I want** a main "Conversations" menu with sub-menus for "My Conversations", "Pending Conversations", and "Conversation Manager",  
**so that** I can efficiently navigate between different conversation views and manage escalations according to my role and responsibilities.

## Acceptance Criteria

1. **Main Conversations Menu**: Add a new main menu item called "Conversations" to the MenuService navigation structure
2. **My Conversations Submenu**: Create submenu item "My Conversations" that navigates to a page showing all escalations accepted by the current agent
3. **Pending Conversations Submenu**: Create submenu item "Pending Conversations" that navigates to a page showing all conversations awaiting agent acceptance
4. **Conversation Manager Submenu**: Create submenu item "Conversation Manager" that navigates to the existing agent-dashboard page
5. **Menu Structure Integration**: Integrate the new menu structure into the existing AGENT section of the MenuService
6. **Permission-Based Visibility**: Ensure menu items are only visible to users with appropriate agent roles
7. **Navigation Consistency**: Follow existing navigation patterns and styling consistent with other menu items

## Tasks / Subtasks

- [x] **Task 1: Update MenuService Navigation Structure** (AC: 1, 5)
  - [x] Add new "Conversations" parent menu item to AGENT section
  - [x] Configure submenu items with proper routing paths
  - [x] Apply appropriate icons and page status settings
  - [x] Ensure proper permission-based visibility using existing role patterns

- [x] **Task 2: Create My Conversations Page** (AC: 2)
  - [x] Create new Razor page at `/Pages/Agent/MyConversations.razor`
  - [x] Implement page to display escalations accepted by current agent
  - [x] Add page routing and authorization attributes
  - [x] Follow existing page structure and component patterns

- [x] **Task 3: Create Pending Conversations Page** (AC: 3)
  - [x] Create new Razor page at `/Pages/Agent/PendingConversations.razor`
  - [x] Implement page to display unaccepted conversation queue
  - [x] Add page routing and authorization attributes
  - [x] Follow existing page structure and component patterns

- [x] **Task 4: Update Agent Dashboard Navigation** (AC: 4)
  - [x] Verify existing agent-dashboard page route and functionality
  - [x] Ensure "Conversation Manager" submenu correctly navigates to agent-dashboard
  - [x] Test navigation flow between all conversation-related pages

- [x] **Task 5: Testing and Validation** (AC: 6, 7)
  - [x] Test menu visibility for different user roles
  - [x] Verify navigation paths work correctly
  - [x] Validate consistent styling with existing menu items
  - [x] Test responsive behavior across different screen sizes

## Dev Notes

### Testing
**Testing Standards from Architecture:**
- **Test Location**: Follow existing pattern - unit tests in `tests/Server.UI.Tests/`
- **Testing Framework**: Use Blazor component testing with bUnit framework
- **Test Requirements**: 
  - Unit tests for menu service updates
  - Component tests for new pages
  - Navigation integration tests
  - Permission-based visibility tests

### Relevant Source Tree Information

**MenuService Location**: `src/Server.UI/Services/Navigation/MenuService.cs`
- Current structure has AGENT section with Agent parent menu containing Conversations submenu
- Need to restructure to make Conversations the parent with agent-specific submenus

**Page Structure Pattern**: Based on existing pages like `/Pages/Issues/`
- Follow standard Blazor Server page structure
- Use MudBlazor components for consistent UI
- Implement proper authorization attributes
- Include SignalR integration for real-time updates where applicable

**Navigation Models**: `src/Server.UI/Models/NavigationMenu/`
- `MenuSectionModel` for main sections
- `MenuSectionItemModel` for menu items  
- `MenuSectionSubItemModel` for submenu items
- Use `IsParent = true` for parent menu items

**Permission Patterns**: Follow existing role-based authorization
- Use `RoleName.Admin` and `RoleName.Users` constants from `CleanArchitecture.Blazor.Application.Common.Constants.Roles`
- Apply `[Authorize(Policy = Permissions.Agent.View)]` or similar for agent-specific permissions

**Routing Conventions**: 
- Agent pages follow `/agent/` prefix pattern
- Use consistent kebab-case naming for routes
- Maintain RESTful URL structure

**Icon Standards**: Use Material Design icons from `Icons.Material.Filled`
- Follow existing icon choices for similar functionality
- Maintain visual consistency with current menu styling

**Page Status Options**: 
- `PageStatus.Completed` for implemented features
- `PageStatus.ComingSoon` for planned features
- `PageStatus.InProgress` for features under development

### Architecture Integration Points

**Existing Agent Infrastructure**:
- Agent dashboard already exists at `/agent-dashboard` route
- Conversation functionality may already be partially implemented
- SignalR NotificationHub available for real-time updates
- IMediator pattern for CQRS commands/queries

**Dependencies**:
- MudBlazor component library for UI consistency
- ASP.NET Core Identity for authorization
- Existing agent role and permission infrastructure
- SignalR service for real-time conversation updates

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-01-09 | 1.0 | Initial story creation for conversations menu navigation | scrum-master |

## Dev Agent Record

### Agent Model Used
GitHub Copilot (Claude 3.5 Sonnet integration)

### Debug Log References  
- Terminal outputs from build verification: `dotnet build src/Server.UI/IssueManager.UI.csproj` - Build succeeded in 3.3s with no errors
- Compilation error resolution for authentication patterns and DTO property mappings
- Successful integration with existing MudBlazor and Clean Architecture patterns

### Completion Notes List
- Successfully restructured MenuService to create dedicated CONVERSATIONS section instead of nested under AGENT
- Implemented MyConversations.razor page with proper authentication integration using AuthenticationStateProvider
- Implemented PendingConversations.razor page with conversation acceptance workflow and priority filtering
- All pages follow existing architectural patterns (MudBlazor components, Clean Architecture CQRS, proper authorization)
- Build verification completed successfully with no compilation errors
- Navigation structure properly integrated with existing permission-based visibility patterns

### File List
- **Modified**: `src/Server.UI/Services/Navigation/MenuService.cs` - Restructured navigation to create CONVERSATIONS parent menu with three submenus
- **Created**: `src/Server.UI/Pages/Agent/MyConversations.razor` - Page displaying agent's assigned conversations with search and filtering
- **Created**: `src/Server.UI/Pages/Agent/PendingConversations.razor` - Page displaying unassigned conversations with acceptance workflow
- **Created**: `tests/Server.UI.Tests/Services/Navigation/MenuServiceConversationsTests.cs` - Unit tests for navigation structure validation

## QA Results

_Results from QA Agent review will be added here after implementation_
