@using CleanArchitecture.Blazor.Application.Features.Issues.Queries.GetPerformanceStats
@using Microsoft.Extensions.Localization
@using MudBlazor

@inject IStringLocalizer<CategoryPerformanceTable> L

<MudSimpleTable Dense="true" Hover="true" FixedHeader="true" Style="max-height: 350px; overflow-y: auto;">
    <thead>
        <tr>
            <th>@L["Category"]</th>
            <th>@L["Total"]</th>
            <th>@L["Resolved"]</th>
            <th>@L["Rate"]</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var category in Categories.OrderByDescending(c => c.TotalIssues))
        {
            <tr>
                <td>
                    <MudChip T="string" Size="Size.Small" Color="Color.Primary" Variant="Variant.Outlined">
                        @category.Category.ToString()
                    </MudChip>
                </td>
                <td>@category.TotalIssues</td>
                <td>@category.ResolvedIssues</td>
                <td>
                    <MudProgressLinear Value="@category.ResolutionRate" 
                                      Color="@GetRateColor(category.ResolutionRate)" 
                                      Size="Size.Small" 
                                      Class="my-1" />
                    <MudText Typo="Typo.caption">@category.ResolutionRateFormatted</MudText>
                </td>
            </tr>
        }
    </tbody>
</MudSimpleTable>

@code {
    [Parameter] public List<CategoryPerformanceDto> Categories { get; set; } = default!;

    private Color GetRateColor(double rate) => rate switch
    {
        >= 90 => Color.Success,
        >= 70 => Color.Info,
        >= 50 => Color.Warning,
        _ => Color.Error
    };
}
